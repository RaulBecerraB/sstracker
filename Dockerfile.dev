# Development Dockerfile with hot reload support
FROM mcr.microsoft.com/dotnet/sdk:8.0

# Install Node.js
RUN curl -fsSL https://deb.nodesource.com/setup_18.x | bash - \
    && apt-get install -y nodejs

# Set working directory
WORKDIR /app

# Copy project files for restore
COPY *.csproj ./
RUN dotnet restore

# Copy package.json for npm install
COPY ClientApp/package*.json ./ClientApp/
WORKDIR /app/ClientApp
RUN npm install

# Go back to app directory
WORKDIR /app

# Expose ports
EXPOSE 5007

# Create entrypoint script
RUN echo '#!/bin/bash\n\
set -e\n\
echo "ðŸ”¥ Starting development mode with hot reload..."\n\
echo "ðŸ“¦ Building React app..."\n\
cd /app/ClientApp && npm run build\n\
echo "ðŸš€ Starting .NET with file watching..."\n\
cd /app\n\
exec dotnet watch run --urls "http://0.0.0.0:5007"\n\
' > /entrypoint.sh && chmod +x /entrypoint.sh

CMD ["/entrypoint.sh"]
